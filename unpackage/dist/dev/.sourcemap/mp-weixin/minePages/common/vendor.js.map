{"version":3,"sources":["uni-app:///js_sdk/wa-permission/permission.js"],"names":["isIos","judgeIosPermissionPush","result","UIApplication","plus","ios","import","app","sharedApplication","enabledTypes","currentUserNotificationSettings","settings","plusGetAttribute","console","log","deleteObject","enabledRemoteNotificationTypes","judgeIosPermissionLocation","cllocationManger","status","authorizationStatus","judgeIosPermissionRecord","avaudiosession","avaudio","sharedInstance","permissionStatus","recordPermission","judgeIosPermissionCamera","AVCaptureDevice","authStatus","authorizationStatusForMediaType","judgeIosPermissionPhotoLibrary","PHPhotoLibrary","judgeIosPermissionContact","CNContactStore","cnAuthStatus","authorizationStatusForEntityType","judgeIosPermissionCalendar","EKEventStore","ekAuthStatus","judgeIosPermissionMemo","requestAndroidPermission","permissionID","Promise","resolve","reject","android","requestPermissions","resultObj","i","granted","length","grantedPermission","deniedPresent","deniedPresentPermission","deniedAlways","deniedAlwaysPermission","error","code","message","judgeIosPermission","gotoAppPermissionSetting","application2","NSURL2","setting2","URLWithString","openURL","Intent","importClass","Settings","Uri","mainActivity","runtimeMainActivity","intent","setAction","ACTION_APPLICATION_DETAILS_SETTINGS","uri","fromParts","getPackageName","setData","startActivity","checkSystemEnableLocation","locationServicesEnabled","context","locationManager","main","mainSvr","getSystemService","LOCATION_SERVICE","isProviderEnabled","GPS_PROVIDER","module","exports"],"mappings":"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","file":"minePages/common/vendor.js","sourcesContent":["/**\r\n * 本模块封装了Android、iOS的应用权限判断、打开应用权限设置界面、以及位置系统服务是否开启\r\n */\r\n\r\nvar isIos\r\n\r\n\r\n\r\n\r\n// 判断推送权限是否开启\r\nfunction judgeIosPermissionPush() {\r\n\tvar result = false;\r\n\tvar UIApplication = plus.ios.import(\"UIApplication\");\r\n\tvar app = UIApplication.sharedApplication();\r\n\tvar enabledTypes = 0;\r\n\tif (app.currentUserNotificationSettings) {\r\n\t\tvar settings = app.currentUserNotificationSettings();\r\n\t\tenabledTypes = settings.plusGetAttribute(\"types\");\r\n\t\tconsole.log(\"enabledTypes1:\" + enabledTypes);\r\n\t\tif (enabledTypes == 0) {\r\n\t\t\tconsole.log(\"推送权限没有开启\");\r\n\t\t} else {\r\n\t\t\tresult = true;\r\n\t\t\tconsole.log(\"已经开启推送功能!\")\r\n\t\t}\r\n\t\tplus.ios.deleteObject(settings);\r\n\t} else {\r\n\t\tenabledTypes = app.enabledRemoteNotificationTypes();\r\n\t\tif (enabledTypes == 0) {\r\n\t\t\tconsole.log(\"推送权限没有开启!\");\r\n\t\t} else {\r\n\t\t\tresult = true;\r\n\t\t\tconsole.log(\"已经开启推送功能!\")\r\n\t\t}\r\n\t\tconsole.log(\"enabledTypes2:\" + enabledTypes);\r\n\t}\r\n\tplus.ios.deleteObject(app);\r\n\tplus.ios.deleteObject(UIApplication);\r\n\treturn result;\r\n}\r\n\r\n// 判断定位权限是否开启\r\nfunction judgeIosPermissionLocation() {\r\n\tvar result = false;\r\n\tvar cllocationManger = plus.ios.import(\"CLLocationManager\");\r\n\tvar status = cllocationManger.authorizationStatus();\r\n\tresult = (status != 2)\r\n\tconsole.log(\"定位权限开启：\" + result);\r\n\t// 以下代码判断了手机设备的定位是否关闭，推荐另行使用方法 checkSystemEnableLocation\r\n\t/* var enable = cllocationManger.locationServicesEnabled();\r\n\tvar status = cllocationManger.authorizationStatus();\r\n\tconsole.log(\"enable:\" + enable);\r\n\tconsole.log(\"status:\" + status);\r\n\tif (enable && status != 2) {\r\n\t\tresult = true;\r\n\t\tconsole.log(\"手机定位服务已开启且已授予定位权限\");\r\n\t} else {\r\n\t\tconsole.log(\"手机系统的定位没有打开或未给予定位权限\");\r\n\t} */\r\n\tplus.ios.deleteObject(cllocationManger);\r\n\treturn result;\r\n}\r\n\r\n// 判断麦克风权限是否开启\r\nfunction judgeIosPermissionRecord() {\r\n\tvar result = false;\r\n\tvar avaudiosession = plus.ios.import(\"AVAudioSession\");\r\n\tvar avaudio = avaudiosession.sharedInstance();\r\n\tvar permissionStatus = avaudio.recordPermission();\r\n\tconsole.log(\"permissionStatus:\" + permissionStatus);\r\n\tif (permissionStatus == 1684369017 || permissionStatus == 1970168948) {\r\n\t\tconsole.log(\"麦克风权限没有开启\");\r\n\t} else {\r\n\t\tresult = true;\r\n\t\tconsole.log(\"麦克风权限已经开启\");\r\n\t}\r\n\tplus.ios.deleteObject(avaudiosession);\r\n\treturn result;\r\n}\r\n\r\n// 判断相机权限是否开启\r\nfunction judgeIosPermissionCamera() {\r\n\tvar result = false;\r\n\tvar AVCaptureDevice = plus.ios.import(\"AVCaptureDevice\");\r\n\tvar authStatus = AVCaptureDevice.authorizationStatusForMediaType('vide');\r\n\tconsole.log(\"authStatus:\" + authStatus);\r\n\tif (authStatus == 3) {\r\n\t\tresult = true;\r\n\t\tconsole.log(\"相机权限已经开启\");\r\n\t} else {\r\n\t\tconsole.log(\"相机权限没有开启\");\r\n\t}\r\n\tplus.ios.deleteObject(AVCaptureDevice);\r\n\treturn result;\r\n}\r\n\r\n// 判断相册权限是否开启\r\nfunction judgeIosPermissionPhotoLibrary() {\r\n\tvar result = false;\r\n\tvar PHPhotoLibrary = plus.ios.import(\"PHPhotoLibrary\");\r\n\tvar authStatus = PHPhotoLibrary.authorizationStatus();\r\n\tconsole.log(\"authStatus:\" + authStatus);\r\n\tif (authStatus == 3) {\r\n\t\tresult = true;\r\n\t\tconsole.log(\"相册权限已经开启\");\r\n\t} else {\r\n\t\tconsole.log(\"相册权限没有开启\");\r\n\t}\r\n\tplus.ios.deleteObject(PHPhotoLibrary);\r\n\treturn result;\r\n}\r\n\r\n// 判断通讯录权限是否开启\r\nfunction judgeIosPermissionContact() {\r\n\tvar result = false;\r\n\tvar CNContactStore = plus.ios.import(\"CNContactStore\");\r\n\tvar cnAuthStatus = CNContactStore.authorizationStatusForEntityType(0);\r\n\tif (cnAuthStatus == 3) {\r\n\t\tresult = true;\r\n\t\tconsole.log(\"通讯录权限已经开启\");\r\n\t} else {\r\n\t\tconsole.log(\"通讯录权限没有开启\");\r\n\t}\r\n\tplus.ios.deleteObject(CNContactStore);\r\n\treturn result;\r\n}\r\n\r\n// 判断日历权限是否开启\r\nfunction judgeIosPermissionCalendar() {\r\n\tvar result = false;\r\n\tvar EKEventStore = plus.ios.import(\"EKEventStore\");\r\n\tvar ekAuthStatus = EKEventStore.authorizationStatusForEntityType(0);\r\n\tif (ekAuthStatus == 3) {\r\n\t\tresult = true;\r\n\t\tconsole.log(\"日历权限已经开启\");\r\n\t} else {\r\n\t\tconsole.log(\"日历权限没有开启\");\r\n\t}\r\n\tplus.ios.deleteObject(EKEventStore);\r\n\treturn result;\r\n}\r\n\r\n// 判断备忘录权限是否开启\r\nfunction judgeIosPermissionMemo() {\r\n\tvar result = false;\r\n\tvar EKEventStore = plus.ios.import(\"EKEventStore\");\r\n\tvar ekAuthStatus = EKEventStore.authorizationStatusForEntityType(1);\r\n\tif (ekAuthStatus == 3) {\r\n\t\tresult = true;\r\n\t\tconsole.log(\"备忘录权限已经开启\");\r\n\t} else {\r\n\t\tconsole.log(\"备忘录权限没有开启\");\r\n\t}\r\n\tplus.ios.deleteObject(EKEventStore);\r\n\treturn result;\r\n}\r\n\r\n// Android权限查询\r\nfunction requestAndroidPermission(permissionID) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tplus.android.requestPermissions(\r\n\t\t\t[permissionID], // 理论上支持多个权限同时查询，但实际上本函数封装只处理了一个权限的情况。有需要的可自行扩展封装\r\n\t\t\tfunction(resultObj) {\r\n\t\t\t\tvar result = 0;\r\n\t\t\t\tfor (var i = 0; i < resultObj.granted.length; i++) {\r\n\t\t\t\t\tvar grantedPermission = resultObj.granted[i];\r\n\t\t\t\t\r\n\t\t\t\t\tresult = 1\r\n\t\t\t\t}\r\n\t\t\t\tfor (var i = 0; i < resultObj.deniedPresent.length; i++) {\r\n\t\t\t\t\tvar deniedPresentPermission = resultObj.deniedPresent[i];\r\n\t\t\t\t\r\n\t\t\t\t\tresult = 0\r\n\t\t\t\t}\r\n\t\t\t\tfor (var i = 0; i < resultObj.deniedAlways.length; i++) {\r\n\t\t\t\t\tvar deniedAlwaysPermission = resultObj.deniedAlways[i];\r\n\t\t\t\t\r\n\t\t\t\t\tresult = -1\r\n\t\t\t\t}\r\n\t\t\t\tresolve(result);\r\n\t\t\t\t// 若所需权限被拒绝,则打开APP设置界面,可以在APP设置界面打开相应权限\r\n\t\t\t\t// if (result != 1) {\r\n\t\t\t\t// gotoAppPermissionSetting()\r\n\t\t\t\t// }\r\n\t\t\t},\r\n\t\t\tfunction(error) {\r\n\t\t\t\tconsole.log('申请权限错误：' + error.code + \" = \" + error.message);\r\n\t\t\t\tresolve({\r\n\t\t\t\t\tcode: error.code,\r\n\t\t\t\t\tmessage: error.message\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t);\r\n\t});\r\n}\r\n\r\n// 使用一个方法，根据参数判断权限\r\nfunction judgeIosPermission(permissionID) {\r\n\tif (permissionID == \"location\") {\r\n\t\treturn judgeIosPermissionLocation()\r\n\t} else if (permissionID == \"camera\") {\r\n\t\treturn judgeIosPermissionCamera()\r\n\t} else if (permissionID == \"photoLibrary\") {\r\n\t\treturn judgeIosPermissionPhotoLibrary()\r\n\t} else if (permissionID == \"record\") {\r\n\t\treturn judgeIosPermissionRecord()\r\n\t} else if (permissionID == \"push\") {\r\n\t\treturn judgeIosPermissionPush()\r\n\t} else if (permissionID == \"contact\") {\r\n\t\treturn judgeIosPermissionContact()\r\n\t} else if (permissionID == \"calendar\") {\r\n\t\treturn judgeIosPermissionCalendar()\r\n\t} else if (permissionID == \"memo\") {\r\n\t\treturn judgeIosPermissionMemo()\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n// 跳转到**应用**的权限页面\r\nfunction gotoAppPermissionSetting() {\r\n\tif (isIos) {\r\n\t\tvar UIApplication = plus.ios.import(\"UIApplication\");\r\n\t\tvar application2 = UIApplication.sharedApplication();\r\n\t\tvar NSURL2 = plus.ios.import(\"NSURL\");\r\n\t\t// var setting2 = NSURL2.URLWithString(\"prefs:root=LOCATION_SERVICES\");\t\t\r\n\t\tvar setting2 = NSURL2.URLWithString(\"app-settings:\");\r\n\t\tapplication2.openURL(setting2);\r\n\r\n\t\tplus.ios.deleteObject(setting2);\r\n\t\tplus.ios.deleteObject(NSURL2);\r\n\t\tplus.ios.deleteObject(application2);\r\n\t} else {\r\n\t\t// console.log(plus.device.vendor);\r\n\t\tvar Intent = plus.android.importClass(\"android.content.Intent\");\r\n\t\tvar Settings = plus.android.importClass(\"android.provider.Settings\");\r\n\t\tvar Uri = plus.android.importClass(\"android.net.Uri\");\r\n\t\tvar mainActivity = plus.android.runtimeMainActivity();\r\n\t\tvar intent = new Intent();\r\n\t\tintent.setAction(Settings.ACTION_APPLICATION_DETAILS_SETTINGS);\r\n\t\tvar uri = Uri.fromParts(\"package\", mainActivity.getPackageName(), null);\r\n\t\tintent.setData(uri);\r\n\t\tmainActivity.startActivity(intent);\r\n\t}\r\n}\r\n\r\n// 检查系统的设备服务是否开启\r\n// var checkSystemEnableLocation = async function () {\r\nfunction checkSystemEnableLocation() {\r\n\tif (isIos) {\r\n\t\tvar result = false;\r\n\t\tvar cllocationManger = plus.ios.import(\"CLLocationManager\");\r\n\t\tvar result = cllocationManger.locationServicesEnabled();\r\n\t\tconsole.log(\"系统定位开启:\" + result);\r\n\t\tplus.ios.deleteObject(cllocationManger);\r\n\t\treturn result;\r\n\t} else {\r\n\t\tvar context = plus.android.importClass(\"android.content.Context\");\r\n\t\tvar locationManager = plus.android.importClass(\"android.location.LocationManager\");\r\n\t\tvar main = plus.android.runtimeMainActivity();\r\n\t\tvar mainSvr = main.getSystemService(context.LOCATION_SERVICE);\r\n\t\tvar result = mainSvr.isProviderEnabled(locationManager.GPS_PROVIDER);\r\n\t\tconsole.log(\"系统定位开启:\" + result);\r\n\t\treturn result\r\n\t}\r\n}\r\n\r\nmodule.exports = {\r\n\tjudgeIosPermission: judgeIosPermission,\r\n\trequestAndroidPermission: requestAndroidPermission,\r\n\tcheckSystemEnableLocation: checkSystemEnableLocation,\r\n\tgotoAppPermissionSetting: gotoAppPermissionSetting\r\n}\r\n"],"sourceRoot":""}